{{ block title }}
    The Key Principle of the Allocation Process: <br>
    Training Round {{ player.round_number }}/3
{{ endblock }}

{{ block styles}}
    <link rel="stylesheet" href="{{ static 'global/styles.css' }}">
    <!-- Font Awesome -->
    <script src="https://kit.fontawesome.com/f5aad88875.js" crossorigin="anonymous"></script>
{{ endblock }}

{{ block content }}
<section id="step-1">
<h4>Step 1: Round Information</h4>
    <div class="explain">
    <p>
        This is a training round.<br>
        Please follow the instructions and answer the questions shown to you as best you can.<br>
        The prizes are not worth money this round, but <b>you will earn 30p</b> for completing it.
    </p>
    </div>

    <p>
        In this round, the <b>prizes</b> are:
    </p>
        <table id="prize-table">
            <thead>
                <tr>
                    <th>Prize</th>
                    <th>A</th>
                    <th>B</th>
                    <th>C</th>
                    <th>D</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Addition to your earnings if you get this prize</td>
                    <td colspan="4">- Training round. No earnings from prizes -</td>
                </tr>
            </tbody>
        </table><br>

        <p>
            The <b>prize priorities</b> for you and for the other participants are:
        </p>

        <table id="priorities-table">
            <thead>
                <tr>
                    <th>Prize</th>
                    <th>A</th>
                    <th>B</th>
                    <th>C</th>
                    <th>D</th>
                </tr>
            </thead>
        </table><br>

        <div class="btn-container">
            <button id="proceed-step-2-btn" type="button" class="btn btn-primary">Proceed</button>
        </div>   
</section>

<section id="step-2">
<h4>Step 2: Submit Your Ranking</h4>

        <p>
            Please rank the four prizes <b>in the arbitrary order <span class="expected-rank"></span></b> (from most to least preferred).
        </p>
        <ul>
            <li>{{ formfield 'first_priority' }}</li>
            <li>{{ formfield 'second_priority' }}</li>
            <li>{{ formfield 'third_priority' }}</li>
            <li>{{ formfield 'fourth_priority' }}</li>
        </ul>
    <div class="btn-container">
        <!-- class="btn btn-danger btn-container" for submit button-->
        <button id="ranking-submit-btn" type="button" class="btn btn-danger btn-container">Submit ranking</button>
    </div>
    <div class="incorrect-msg">
        <p>
            Please make sure your ranking follows the instructions.
        </p>
    </div>
</section>

<section id="step-3">
<h4>Step 3: Allocation Process</h4>
    <div id="load">
        <p>
            Allocation process workingâ€¦ <i class="fa-regular fa-hourglass-half fa-spin"></i>
        </p>
    </div>

    <div id="round-results">
        <p>
            <b>You get prize <span class="prize-won"></span></b>.
        </p>
    </div>
</section>

<section id="training-questions">
    {{ if player.round_number == 1 }}
        <ol>
            <li id="general-property" class="question">
                Imagine the computer determined some prize priorities and rankings of the other, computerized participants.
                Submitting a ranking that follows the order of the prizes in some list always gets me a prize
                <b>at least as high on the list</b>, compared to the prize I would get if I submitted any different,
                alternative ranking.

                {{ formfield 'general_property' }}

                <div class="incorrect-seq-field">
                    {{ formfield 'incorrect_seq_general_property' }}
                </div>

                <div class="btn-container">
                    <button type="button" class="btn btn-primary btn-question">Submit</button>
                </div>

                <div class="incorrect-msg">
                    <p>
                        Incorrect answer. Please try again.
                    </p>
                </div>

                <div class="correct-msg">
                    <p>
                        Correct! The prize you get if you submit any different,
                        alternative ranking can only be <b>the same</b> as the prize you get when submitting a ranking that follows that order,
                        or some prize <b>lower according to that order</b>.
                    </p>
                </div>
            </li>
            <li id="self-rank-independence" class="question">
                If I place a prize <b>very low</b> in my ranking, then <b>my priority</b> at that prize might decrease.
                If I place a prize <b>very high</b> in my ranking, then <b>my priority</b> at that prize might increase.

                {{ formfield 'self_rank_independence' }}

                <div class="incorrect-seq-field">
                    {{ formfield 'incorrect_seq_self_rank_independence' }}
                </div>

                <div class="btn-container" class="question">
                    <button type="button" class="btn btn-primary btn-question">Submit</button>
                </div>

                <div class="incorrect-msg">
                    <p>
                        Incorrect answer. Please try again.
                    </p>
                </div>

                <div class="correct-msg">
                    <p>
                        Correct! Your own ranking <b>cannot affect the prize priorities</b>, which are determined at random.
                    </p>
                </div>
            </li>
            <li id="competitors-rank-independence" class="question">
                Imagine the computer determined some prize priorities.
                Imagine you submitted the ranking A-B-C-D and got Prize B.
                It is <b>impossible</b> that if you had submitted a different ranking,
                your ranking would have affected the other participants' rankings such that you would have gotten Prize A.

                {{ formfield 'competitors_rank_independence' }}

                <div class="incorrect-seq-field">
                    {{ formfield 'incorrect_seq_competitors_rank_independence' }}
                </div>

                <div class="btn-container" class="question">
                    <button type="button" class="btn btn-primary btn-question">Submit</button>
                </div>

                <div class="incorrect-msg">
                    <p>
                        Incorrect answer. Please try again.
                    </p>
                </div>

                <div class="correct-msg">
                    <p>
                        Correct! Your own ranking <b>cannot affect the other participants' rankings</b>. Instead, these are determined at random.
                    </p>
                </div>
            </li>
            <li id="mechanism-misconception-1" class="question">
                Submitting some ranking <b>cannot</b> ensure that I will get the <b>most</b> preferred prize in that ranking,
                but it <b>does</b> ensure that I will <b>not</b> get the <b>least</b> preferred prize in that ranking.

                {{ formfield 'mechanism_misconception_1' }}

                <div class="incorrect-seq-field">
                    {{ formfield 'incorrect_seq_mechanism_misconception_1' }}
                </div>

                <div class="btn-container" class="question">
                    <button type="button" class="btn btn-primary btn-question">Submit</button>
                </div>

                <div class="incorrect-msg">
                    <p>
                        Incorrect answer. Please try again.
                    </p>
                </div>

                <div class="correct-msg">
                    <p>
                        Correct! The allocation process only ensures you a prize <b>at least as preferred in your submitted ranking</b>
                        compared to the prize you would get if you submitted some different, alternative ranking.
                        On some occasions, <b>the prize you get may be your least preferred one</b>.
                    </p>
                </div>
            </li>
            <li id="mechanism-misconception-2" class="question">
                Imagine I have a low priority at Prize <span class="prize-won"></span>, which is the prize I want the most,
                but I have a high priority at Prize B, which I want the second most.
                Then, submitting a ranking that places Prize A first and Prize B second may lead to missing out on both Prizes A and B,
                while submitting a different ranking could have gotten me Prize B.

                {{ formfield 'mechanism_misconception_2' }}

                <div class="incorrect-seq-field">
                    {{ formfield 'incorrect_seq_mechanism_misconception_2' }}
                </div>

                <div class="btn-container" class="question">
                    <button type="button" class="btn btn-primary btn-question">Submit</button>
                </div>

                <div class="incorrect-msg">
                    <p>
                        Incorrect answer. Please try again.
                    </p>
                </div>

                <div class="correct-msg">
                    <p>
                        Correct! Imagine submitting a ranking that places Prize A first and Prize B second,
                        but getting some prize other than Prize A or Prize B. Remember that submitting different,
                        alternative rankings can only get you that <b>same prize</b>, or some other <b>lower prize</b> according to your original ranking.
                        This is true <b>regardless of your priorities at these prizes</b>.
                    </p>
                </div>
            </li>
            <li id="different-rank-outcome" class="question">
                Remember: You submitted the ranking <span class="expected-rank"></span> (from most to least preferred),
                and ended up getting Prize <span class="prize-won"></span>. Imagine you had instead submitted a different ranking,
                while nothing else changed (in particular, all prize priorities and other participants' rankings remain the same).
                Which of the following might be true? (select one answer)
                (Hint: think about what the set of Obtainable Prizes could possibly be.)

                {{ formfield 'different_rank_outcome' }}

                <div class="incorrect-seq-field">
                    {{ formfield 'incorrect_seq_different_rank_outcome' }}
                </div>

                <div class="btn-container" class="question">
                    <button type="button" class="btn btn-primary btn-question">Submit</button>
                </div>

                <div class="incorrect-msg">
                    <p>
                        Incorrect answer. Please try again.
                    </p>
                </div>

                <div class="correct-msg">
                    <p>
                        Correct! Submitting a ranking that does not follow the order of the list <span class="expected-rank"></span>
                        could have only gotten you the <b>same prize</b> as when submitting the ranking <span class="expected-rank"></span>,
                        that is, Prize <span class="prize-won"></span>, or some prize <b>lower</b> on that list, that is, Prize D. In other words,
                        no alternative, different ranking could have gotten you Prize C or Prize B.
                    </p>
                </div>
            </li>
        </ol>
    {{ endif }}
    {{ if player.round_number > 1 }}
        <ol>
            <li id="ranking-change" class="question">
                Remember: You submitted the ranking <span class="expected-rank"></span> (from most to least preferred),
                and ended up getting Prize <span class="prize-won"></span>. Imagine you had instead submitted a different ranking,
                while nothing else changed (in particular, all prize priorities and other participants' rankings remain the same).
                Given the <b>important property</b> behind the allocation process, which of the following might be true?

                <ul>
                    <li id="ranking-change-1" class="question">
                        If I had instead submitted A-D-B-C, then it is possible that I would have gotten Prize A instead.

                        {{ formfield 'ranking_change_1' }}

                        <div class="incorrect-seq-field">
                            {{ formfield 'incorrect_seq_ranking_change_1' }}
                        </div>

                        <div class="btn-container">
                            <button type="button" class="btn btn-primary btn-question">Submit</button>
                        </div>

                        <div class="incorrect-msg">
                            <p>
                                Incorrect answer. Please try again.
                            </p>
                        </div>

                        <div class="correct-msg">
                            <p>
                                {{ if player.round_number == 2 }}
                                    Correct! Given that you originally ranked Prize A above Prize B but got Prize B,
                                    <b>no ranking</b> could possibly get you Prize A.
                                {{ endif }}

                                {{ if player.round_number == 3 }}
                                    Correct! Given that you originally ranked Prize A last and got it,
                                    every possible alternative ranking would only get you Prize A.
                                {{ endif }}
                            </p>
                        </div>
                    </li>
                    <li id="ranking-change-2" class="question">
                        If I had instead submitted A-D-B-C, then it is possible that I would have gotten Prize D instead.

                        {{ formfield 'ranking_change_2' }}

                        <div class="incorrect-seq-field">
                            {{ formfield 'incorrect_seq_ranking_change_2' }}
                        </div>

                        <div class="btn-container">
                            <button type="button" class="btn btn-primary btn-question">Submit</button>
                        </div>

                        <div class="incorrect-msg">
                            <p>
                                Incorrect answer. Please try again.
                            </p>
                        </div>

                        <div class="correct-msg">
                            <p>
                                {{ if player.round_number == 2 }}
                                    Correct! Given that you originally ranked Prize B above Prize D and got Prize B,
                                    an alternative ranking <b>could</b> possibly get you Prize D.
                                {{ endif }}

                                {{ if player.round_number == 3 }}
                                    Correct! Given that you originally ranked Prize A last and got it,
                                    every possible alternative ranking would only get you Prize A.
                                {{ endif }}
                            </p>
                        </div>
                    </li>
                    <li id="ranking-change-3" class="question">
                        If I had instead submitted A-D-B-C, then it is possible that I would have gotten Prize C instead.

                        {{ formfield 'ranking_change_3' }}

                        <div class="incorrect-seq-field">
                            {{ formfield 'incorrect_seq_ranking_change_3' }}
                        </div>

                        <div class="btn-container">
                            <button type="button" class="btn btn-primary btn-question">Submit</button>
                        </div>

                        <div class="incorrect-msg">
                            <p>
                                Incorrect answer. Please try again.
                            </p>
                        </div>

                        <div class="correct-msg">
                            <p>
                                {{ if player.round_number == 2 }}
                                    Correct! If you would have gotten Prize C when submitting this new ranking,
                                    then getting Prize B by submitting your original ranking would be impossible,
                                    since Prize B is ranked higher in this new ranking than Prize C.
                                {{ endif }}

                                {{ if player.round_number == 3 }}
                                    Correct! Given that you originally ranked Prize A last and got it,
                                    every possible alternative ranking would only get you Prize A.
                                {{ endif }}
                            </p>
                        </div>
                    </li>
                    <li id="ranking-change-4" class="question">
                        If I had instead submitted C-A-B-D, then it is possible that I would have gotten Prize A instead.

                        {{ formfield 'ranking_change_4' }}

                        <div class="incorrect-seq-field">
                            {{ formfield 'incorrect_seq_ranking_change_4' }}
                        </div>

                        <div class="btn-container">
                            <button type="button" class="btn btn-primary btn-question">Submit</button>
                        </div>

                        <div class="incorrect-msg">
                            <p>
                                Incorrect answer. Please try again.
                            </p>
                        </div>

                        <div class="correct-msg">
                            <p>
                                {{ if player.round_number == 2 }}
                                    Correct! Given that you originally ranked Prize A above Prize B but got Prize B,
                                    <b>no ranking</b> could possibly get you Prize A.
                                {{ endif }}

                                {{ if player.round_number == 3 }}
                                    Correct! Given that you originally ranked Prize A last and got it,
                                    every possible alternative ranking would only get you Prize A.
                                {{ endif }}
                            </p>
                        </div>
                    </li>
                    <li id="ranking-change-5" class="question">
                        If I had instead submitted C-A-B-D, then it is possible that I would have gotten Prize C instead.

                        {{ formfield 'ranking_change_5' }}

                        <div class="incorrect-seq-field">
                            {{ formfield 'incorrect_seq_ranking_change_5' }}
                        </div>

                        <div class="btn-container">
                            <button type="button" class="btn btn-primary btn-question">Submit</button>
                        </div>

                        <div class="incorrect-msg">
                            <p>
                                Incorrect answer. Please try again.
                            </p>
                        </div>

                        <div class="correct-msg">
                            <p>
                                {{ if player.round_number == 2 }}
                                    Correct! Given that you originally ranked Prize B above Prize C and got Prize B,
                                    an alternative ranking <b>could</b> possibly get you Prize C.
                                {{ endif }}

                                {{ if player.round_number == 3 }}
                                    Correct! Given that you originally ranked Prize A last and got it,
                                    every possible alternative ranking would only get you Prize A.
                                {{ endif }}
                            </p>
                        </div>
                    </li>
                </ul>
            </li>
            <li id="brute-force" class="question">
                <p>
                    Imagine you are able to try submitting many different possible rankings,
                    while the prize priorities and other participants' rankings remain the same.
                    Imagine that you try out and submit <b>every</b> possible ranking.
                    After each such submission, you write down the prize that this submission gets you.
                    You end up with a log including some of the Prizes A, B, C and D.
                </p>
                <p>
                    Think about each of the prizes: is that prize <b>definitely</b> included in the log,
                    <b>possibly</b> included in the log, or <b>certainly not</b> included in the log?
                    Choose the correct answer below:
                </p>

                <ul>
                    <li id="brute-force-1" class="question">
                        Prize A:

                        {{ formfield 'brute_force_1' }}

                        <div class="incorrect-seq-field">
                            {{ formfield 'incorrect_seq_brute_force_1' }}
                        </div>

                        <div class="btn-container">
                            <button type="button" class="btn btn-primary btn-question">Submit</button>
                        </div>

                        <div class="incorrect-msg">
                            <p>
                                Incorrect answer. Please try again.
                            </p>
                        </div>

                        <div class="correct-msg">
                            <p>
                                {{ if player.round_number == 2 }}
                                    Correct! Given that you originally ranked Prize A above Prize B but got Prize B,
                                    <b>no ranking</b> could possibly get you Prize A.
                                {{ endif }}

                                {{ if player.round_number == 3 }}
                                    Correct! The ranking that you originally submitted gets you Prize A.
                                {{ endif }}
                            </p>
                        </div>
                    </li>
                    <li id="brute-force-2" class="question">
                        Prize B:

                        {{ formfield 'brute_force_2' }}

                        <div class="incorrect-seq-field">
                            {{ formfield 'incorrect_seq_brute_force_2' }}
                        </div>

                        <div class="btn-container">
                            <button type="button" class="btn btn-primary btn-question">Submit</button>
                        </div>

                        <div class="incorrect-msg">
                            <p>
                                Incorrect answer. Please try again.
                            </p>
                        </div>

                        <div class="correct-msg">
                            <p>
                                {{ if player.round_number == 2 }}
                                    Correct! The ranking that you originally submitted gets you Prize B.
                                {{ endif }}

                                {{ if player.round_number == 3 }}
                                    Correct! Given that you originally ranked Prize B above Prize A but got Prize A,
                                    <b>no ranking</b> could possibly get you Prize B.
                                {{ endif }}
                            </p>
                        </div>
                    </li>
                    <li id="brute-force-3" class="question">
                        Prize C:

                        {{ formfield 'brute_force_3' }}

                        <div class="incorrect-seq-field">
                            {{ formfield 'incorrect_seq_brute_force_3' }}
                        </div>

                        <div class="btn-container">
                            <button type="button" class="btn btn-primary btn-question">Submit</button>
                        </div>

                        <div class="incorrect-msg">
                            <p>
                                Incorrect answer. Please try again.
                            </p>
                        </div>

                        <div class="correct-msg">
                            <p>
                                {{ if player.round_number == 2 }}
                                    Correct! Given that you originally ranked Prize B above Prize C and got Prize B,
                                    an alternative ranking <b>could</b> possibly get you Prize C.
                                {{ endif }}

                                {{ if player.round_number == 3 }}
                                    Correct! Given that you originally ranked Prize C above Prize A but got Prize A,
                                    <b>no ranking</b> could possibly get you Prize C.
                                {{ endif }}
                            </p>
                        </div>
                    </li>
                    <li id="brute-force-4" class="question">
                        Prize D:

                        {{ formfield 'brute_force_4' }}

                        <div class="incorrect-seq-field">
                            {{ formfield 'incorrect_seq_brute_force_4' }}
                        </div>

                        <div class="btn-container">
                            <button type="button" class="btn btn-primary btn-question">Submit</button>
                        </div>

                        <div class="incorrect-msg">
                            <p>
                                Incorrect answer. Please try again.
                            </p>
                        </div>

                        <div class="correct-msg">
                            <p>
                                {{ if player.round_number == 2 }}
                                    Correct! Given that you originally ranked Prize B above Prize D and got Prize B,
                                    an alternative ranking <b>could</b> possibly get you Prize D.
                                {{ endif }}

                                {{ if player.round_number == 3 }}
                                    Correct! Given that you originally ranked Prize D above Prize A but got Prize A,
                                    <b>no ranking</b> could possibly get you Prize D.
                                {{ endif }}
                            </p>
                        </div>
                    </li>
                </ul>
            </li>
        </ol>
    {{ endif }}
</section>

<section id="next">
    <p>
        You have completed this training round! You get <b><span id="points-won"></span>p</b>.
        Click the button below to proceed.
    </p>

    {{ next_button }}
</section>
{{ endblock }}

{{ block scripts }}
    <script src="{{ static 'global/property_training_round_page.js' }}"></script>
    <script src="{{ static 'global/generate_priorities_table.js' }}"></script>
{{ endblock }}
